# P6 當 AI 充滿自信地答錯：金融決策中 LLM 的校準與風險分析
# When AI Is Confidently Wrong: Calibration and Risk Analysis of Large Language Models in Financial Decision-Making

> **狀態**：✅ 論文已完成 | **字數**：3,463 | **頁數**：15 | **樣本量**：N=257 觀測值 | **目標期刊**：Finance Research Letters (FRL)
> **論文資料夾**：`drafts/selected/D1_calibration/`
> **合併自**：D1（信心校準）+ D4（過度自信風險分析）
> **投稿優先級**：首選（數據最完整、統計最顯著、指導教授專長對口）
> **備註**：單模型設計（GPT-4o-mini + Qwen3:32b），無 GPT-5-mini 跨模型實驗

---

## 研究背景與問題

當 LLM 回答 CFA 題目時說「我有 90% 的信心」，這個信心值可靠嗎？在金融場景中，最危險的不是「不知道」，而是**「高度自信地給出錯誤答案」**。一個 overconfident 的 AI 投資顧問可能讓客戶接受錯誤的資產配置、讓合規人員忽略實際存在的監管風險。

本研究結合 D1（信心校準品質評估）和 D4（高信心錯誤的風險分析）：
1. **D1**：用多種方法估計模型信心，測量校準品質（ECE、Brier Score）
2. **D4**：篩選「confidence >= 80% 但答案錯誤」的案例，分析哪些 CFA 主題最危險，提出 Confidence-at-Risk (CaR) 指標

---

## 核心方法

### 方法一覽

**信心估計方法**：
- **Verbalized Confidence**：直接在 prompt 中要求模型自評信心 (0-100%)
- **Logit-based Confidence**：透過 API 取得 token-level 機率，計算答案選項的 probability mass

**校準度量**：
- **ECE (Expected Calibration Error)**：將信心分成 10 個 bin，計算每個 bin 中「平均信心 vs 實際正確率」的加權偏差
- **Overconfidence Gap**：平均信心 - 實際準確率（正值 = 過度自信）
- **OC Error Rate**：高信心 (>=80%) 且答錯的比例

**風險指標**：
- **Confidence-at-Risk (CaR)**：類比金融風險管理的 VaR 概念——「在最高信心 alpha% 的回答中，錯誤率是多少？」
- **OC Among Errors**：在所有錯誤答案中，有多少伴隨高信心？

---

### 用一個例子理解

#### 情境：AI 投資顧問回答客戶問題

客戶問：*「我持有一檔存續期間 (duration) 5 年的債券基金。如果利率上升 1%，基金淨值大約會怎樣？」*

**模型回答**：
> 根據修正存續期間概念，利率上升 1% 時，基金淨值大約會**上升 5%**。
> **信心：92%**

**實際情況**：利率上升 → 債券價格**下降**。正確答案是下降約 5%，不是上升。

這就是一個 **overconfident error**：
- 信心 92%（很高）
- 答案完全相反（方向錯誤）
- 如果客戶信任這個建議，可能在利率上升時不做避險，導致虧損

#### 校準的意思

如果一個模型是「well-calibrated（校準良好）」的，那麼：
- 它說「90% 信心」的那些回答中，應該有約 90% 是對的
- 它說「60% 信心」的那些回答中，應該有約 60% 是對的

**實際觀察**（reliability diagram）：

| 模型說的信心 | 實際答對比例 | 差距 |
|------------|------------|------|
| 90% | 58% | 過度自信 32 pp |
| 80% | 55% | 過度自信 25 pp |
| 70% | 52% | 過度自信 18 pp |

→ 幾乎在所有信心水準上都是過度自信的。說 90% 信心時只有 58% 是對的。

#### CaR 是什麼？

類比金融的 VaR (Value at Risk)：

- VaR 回答：「在最壞 5% 的情境下，我的投資組合最多虧多少？」
- CaR 回答：「在最高信心 5% 的回答中，錯誤率是多少？」

如果 CaR(5%) = 30%，意味著即使是 AI 最有把握的那些回答，仍有 30% 是錯的。

---

## 實驗設計（實際執行）

| 項目 | 內容 |
|------|------|
| 測試集 | CFA-Challenge，90 題（高難度） |
| 模型 | GPT-4o-mini, Qwen3:32b |
| 信心方法 | Verbalized confidence + Logit-based confidence |
| 組合 | 2 models × 2 methods × 90 questions → 257 有效觀測 |
| 統計檢定 | One-sample t-test, binomial test, chi-squared test |

---

## 核心結果

### 四大假說全部獲得支持

| 假說 | 內容 | 結果 | 統計量 |
|------|------|------|--------|
| H1 | LLM 系統性高估自身信心 | ✅ Supported | t=9.70, p<0.0001 |
| H2 | 過度自信錯誤佔比超過 25% | ✅ Supported | 30.0%, z=3.99, p<0.0001 |
| H3 | 錯誤答案中過度自信佔主導 | ✅ Supported | 66.4%, z=3.53, p=0.0002 |
| H4 | 校準品質因 CFA 主題而異 | ✅ Supported | chi-squared=12.37, p=0.030 |

### 核心數字

| 指標 | 數值 |
|------|------|
| Overconfidence Gap | +22-32 pp |
| OC Error Rate | **30.0%** (77/257) |
| OC Among Errors | **66.4%** |
| Best ECE | Qwen3:32b = 0.247 |
| Worst ECE | GPT-4o-mini verbalized = 0.315 |

### 主題分析

| CFA 主題 | OC Error Rate | 危險程度 |
|----------|---------------|---------|
| **Ethics** | **43.5%** | 最危險 |
| Fixed Income | 31.2% | 高 |
| Portfolio Management | 28.6% | 中 |
| **Derivatives** | **22.2%** | 最低 |

→ Ethics（倫理判斷）的過度自信率最高，也最不容易被模型自身察覺。

---

## 一句話總結

> **LLM 在金融題目上 30% 的回答是「高度自信但答錯」，而且錯的時候有 66% 是帶著高信心錯的。Ethics 領域最危險（43.5%）。建議金融 AI 部署應設 ECE < 0.15 的校準門檻。**

---

## 附錄

### 合併邏輯

D1 和 D4 是天然的上下游關係：
- D1 收集校準數據（信心 vs 正確率）
- D4 對 D1 篩出的高信心錯誤做深度風險分析

D4 的所有數據直接來自 D1 的實驗結果，拆成兩篇反而重複，合併為一篇更完整。

### 實驗數據路徑

| 資料 | 路徑 |
|------|------|
| 主要結果 (N=250) | `experiments/D1_confidence_calibration/results/run_20260202_034237/results.json` |
| D4 風險分析 | `experiments/D4_overconfident_risk/results/run_20260205_010016/results.json` |
| 分析腳本輸出 | `drafts/selected/D1_calibration/analysis_results.json` |

### 論文檔案結構

```
drafts/selected/D1_calibration/
├── main.tex                    # 完整論文 (15 pages)
├── main.pdf                    # 編譯 PDF
├── run_analysis.py             # 數據分析腳本
├── analysis_results.json       # 分析結果
├── figures/                    # 6 張圖
│   ├── reliability_diagrams.pdf
│   ├── ece_comparison.pdf
│   ├── coverage_accuracy.pdf
│   ├── overconfidence_gap.pdf
│   ├── topic_analysis.pdf
│   └── confidence_distribution.pdf
├── tables/
└── submission/
    └── cover_letter.tex
```
